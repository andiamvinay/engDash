!function(){"use strict";$j(document).ready(function(){var e=document.createElement("div");async function t(){document.getElementById("trends-parent").style.display="";var e=document.createElement("div");e.innerHTML='<style>.lds-roller {\n  display: inline-block;\n  position: relative;\n  width: 300px;\n  height: 300px;\n  background: #80B6A1;\n}\n.lds-roller div {\n  animation: lds-roller 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\n  transform-origin: 40px 40px;\n}\n.lds-roller div:after {\n  content: " ";\n  display: block;\n  position: absolute;\n  width: 7px;\n  height: 7px;\n  border-radius: 50%;\n  background: #fff;\n  margin: -4px 0 0 -4px;\n}\n.lds-roller div:nth-child(1) {\n  animation-delay: -0.036s;\n}\n.lds-roller div:nth-child(1):after {\n  top: 63px;\n  left: 63px;\n}\n.lds-roller div:nth-child(2) {\n  animation-delay: -0.072s;\n}\n.lds-roller div:nth-child(2):after {\n  top: 68px;\n  left: 56px;\n}\n.lds-roller div:nth-child(3) {\n  animation-delay: -0.108s;\n}\n.lds-roller div:nth-child(3):after {\n  top: 71px;\n  left: 48px;\n}\n.lds-roller div:nth-child(4) {\n  animation-delay: -0.144s;\n}\n.lds-roller div:nth-child(4):after {\n  top: 72px;\n  left: 40px;\n}\n.lds-roller div:nth-child(5) {\n  animation-delay: -0.18s;\n}\n.lds-roller div:nth-child(5):after {\n  top: 71px;\n  left: 32px;\n}\n.lds-roller div:nth-child(6) {\n  animation-delay: -0.216s;\n}\n.lds-roller div:nth-child(6):after {\n  top: 68px;\n  left: 24px;\n}\n.lds-roller div:nth-child(7) {\n  animation-delay: -0.252s;\n}\n.lds-roller div:nth-child(7):after {\n  top: 63px;\n  left: 17px;\n}\n.lds-roller div:nth-child(8) {\n  animation-delay: -0.288s;\n}\n.lds-roller div:nth-child(8):after {\n  top: 56px;\n  left: 12px;\n}\n@keyframes lds-roller {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}</style>',$j("#trends-parent").append(e),$j("canvas#closed_at_month").length>0&&$j("canvas#closed_at_month").remove(),$j("canvas#assigned_at_month").length>0&&$j("canvas#assigned_at_month").remove(),$j("canvas#48_hours_percent").length>0&&$j("canvas#48_hours_percent").remove();await a("assigned_on","tcol11","number","sn_customerservice_case","assigned_on"),await a("closed_at","tcol21","number","sn_customerservice_case","closed_at"),await a("48hour","tcol31","number","sn_customerservice_case","48hour")}function n(e,t,n){var a="https://support.servicenow.com/api/now/table/"+e+"?";return a+="sysparm_query="+t+"&",a+="sysparm_fields="+n+"&",$j.ajax({url:a,type:"GET",beforeSend:function(e){e.setRequestHeader("Accept","application/json"),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("X-UserToken",window.g_ck)}})}async function a(e,t,a,i,d){$j(`#${t}`).append('<div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>');var r=new Map;const l=i;let o=$j("#selected_engineer").val(),c=$j('#select_engineer [value="'+o+'"]').data("value").trim();const v=a;let p;try{for(let[t,a]of function(){for(var e,t,n,a,s=new Map,i=new Date,d=11;d>=0;d-=1)t=(e=new Date(i.getFullYear(),i.getMonth()-d,1)).getMonth()+1,n=e.getFullYear(),a=new Date(n,t,0).getDate(),t=1==String(t).length?`0${t}`:t,s.set(`${n}-${t}-01`,`${n}-${t}-${a}`);return s}()){p="48hour"==e?`assigned_to=${c}\n                    ^closed_atBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')\n                    @javascript:gs.dateGenerate('${a}','23:59:59')\n                    ^resolved_atLESSTHANopened_at@hour@after@48`:`assigned_to=${c}^${d}BETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')`;var h=await n(l,p,v);r.set(t,h.result.length)}if("closed_at"==e)return void s(r,"Closed Last 12 months","closed_at_month",t);if("assigned_on"==e)return void s(r,"Assigned in Last 12 months","assigned_at_month",t);if("48hour"==e){let e=Chart.getChart("closed_at_month").data.datasets[0].data,n=[...r.values()];var u=new Map,_=0;for(let[t,a]of r)u.set(t,parseFloat((n[_]/e[_]*100).toFixed(2))),_+=1;return console.log(u),void s(u,"48 hours%","48_hours_percent",t)}}catch(e){console.log(e)}}function s(e,t,n,a){$j(`#${a}`).children()[0].remove();var s=document.createElement("div");s.innerHTML=`<div style="height:300px"><canvas id="${n}"></canvas></div>`,$j(`#${a}`).append(s);let i=[],d=[];for(let[t,n]of e)i.push(t),d.push(n);const r={type:"line",data:{labels:i,datasets:[{label:t,backgroundColor:"rgb(255, 99, 132)",borderColor:"rgb(255, 99, 132)",data:d}]},options:{maintainAspectRatio:!1}};new Chart(document.getElementById(n),r)}e.innerHTML='<button id="switch_to_report_view" type="button">Switch to Report</button>',$j(".sn-canvas-nav-buttons").parent().append(e),document.getElementById("switch_to_report_view").addEventListener("click",function(n){$j(".sn-canvas-left").hide(),$j(".sn-canvas-right").hide(),$j(".icon-cards").hide(),$j(".icon-menu").hide(),document.getElementById("switch_to_report_view").style.display="none",function(){function n(e,t,n){var a="https://support.servicenow.com/api/now/table/"+e+"?";a+="sysparm_query="+n+"&",a+="sysparm_fields="+t+"&";var s=new XMLHttpRequest;return s.open("get",a),s.setRequestHeader("Accept","application/json"),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("X-UserToken",window.g_ck),s}function a(e){var t=$j("#start").val(),a=$j("#end").val(),s=`assigned_to=${e}^closed_atBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')`,i=n("sn_customerservice_case","number",s);i.onreadystatechange=function(){if(this.readyState==this.DONE){var t=JSON.parse(this.response).result.length;$j("#total_closed").text(t),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("sn_customerservice_case","number",`assigned_to=${e}^closed_atBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')\n                ^resolved_atLESSTHANopened_at@hour@after@48`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#48_closed").text(e);var t=parseInt($j("#48_closed").text()),n=parseInt($j("#total_closed").text()),a=(t/n*100).toFixed(2);$j("#48_closed_precentage").text(t>0?a:0)}},s.send()}(e),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("sn_customerservice_case","number",`knowledge=true^assigned_to=${e}^closed_atBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=parseInt($j("#total_closed").text()),t=JSON.parse(this.response).result.length;$j("#attach_rate").text(e>0?(t/e*100).toFixed(2):0)}},s.send()}(e)}},i.send()}(e=document.createElement("div")).innerHTML='\n                <div class="container" id="parent-container-report">\n                  <div class="row">\n                      <div class="vsplit col-sm-8" id="col1">\n                      <div class="header_text">Engineer Dashboard</div>\n                      </div>\n                      <div class="vsplit col-sm-3" id="col2">\n                      </div>\n                 </div>\n                 <div class="row" style="display:none" id="trends-parent">\n                      <div class="header_text">Trends</div>\n                      <div class="vsplit col-sm-4" id="tcol1" >\n                      <div id="tcol11" style="height:300px;"></div>\n                      <div id="tcol12" style="height:300px;"></div>\n                      <div id="tcol13" style="height:300px;"></div>\n                      </div>\n                      <div class="vsplit col-sm-4" id="tcol2">\n                      <div id="tcol21" style="height:300px;"></div>\n                      <div id="tcol22" style="height:300px;"></div>\n                      <div id="tcol23" style="height:300px;"></div>\n                      </div>\n                      <div class="vsplit col-sm-4" id="tcol3">\n                      <div id="tcol31" style="height:300px;"></div>\n                      <div id="tcol32" style="height:300px;"></div>\n                      <div id="tcol33" style="height:300px;"></div>\n                      </div>\n                 </div>\n               </div>\n               <style>\n               .header_text{\n                  font-size: 35px;\n                  font-family: monospace;\n                  margin-top: 20px;\n                  margin-left: 40%;\n                  text-decoration: overline;\n               }\n               .dash-body{\n                    overflow: scroll;\n               }\n               </style>\n               ',$j(".dash-body").append(e),(e=document.createElement("div")).innerHTML="<br><br><br><br><br>",e.innerHTML+='<label for="start">Start date   :  </label>',e.innerHTML+="<br>",e.innerHTML+='<input type="date" id="start" name="start" value="">',e.innerHTML+="<br><br>",e.innerHTML+='<label for="start">End date    :  </label>',e.innerHTML+="<br>",e.innerHTML+='<input type="date" id="end" name="end" value="">',$j("#col2").append(e),(e=document.createElement("div")).innerHTML="<br><br>",e.innerHTML+='<label for="selected_manager">Select Manager:  </label>',e.innerHTML+="<br>",e.innerHTML+=' <input id="selected_manager" list="select_manager" style="width: 70%;"><datalist id="select_manager"></datalist>',$j("#col2").append(e),(e=document.createElement("div")).innerHTML="<br>",e.innerHTML+='<label for="selected_engineer">Select Engineer:  </label>',e.innerHTML+="<br>",e.innerHTML+=' <input id="selected_engineer" list="select_engineer" style="width: 70%;"><datalist id="select_engineer"></datalist>',$j("#col2").append(e),(e=document.createElement("div")).innerHTML="<br><br>",e.innerHTML+='<button id="fetch_data" type="button">Run Report</button>',e.innerHTML+='<button id="show_trends" style="display:none" type="button">Show Trend</button>',e.innerHTML+='<button id="download_file"style="display:none" type="button">Download</button>',$j("#col2").append(e),document.getElementById("fetch_data").addEventListener("click",function(){console.log("Button Clicked");var e=$j("#selected_manager").val(),t=$j("#selected_engineer").val(),s=$j("#start").val(),i=$j("#end").val();if(e&&t&&s&&i){var d=$j("#selected_engineer").val(),r=$j('#select_engineer [value="'+d+'"]').data("value").trim();$j("#total_closed").text("..."),$j("#total_assigned").text("..."),$j("#48_closed").text("..."),$j("#48_closed_precentage").text("..."),$j("#csat").text("..."),$j("#ttr").text("..."),$j("#kb_external").text("..."),$j("#kb_internal").text("..."),$j("#attach_rate").text("..."),$j("#tasks_handled").text("..."),$j("#escalations").text("..."),$j("#sol_rejected").text("..."),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("sn_customerservice_case","number",`assigned_to=${e}^assigned_onBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#total_assigned").text(e)}},s.send()}(r),a(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("task_assessment_detail","metricres_string_value",`task_assigned_to=${e}^asmtins_taken_onBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')\n                ^metricres_instance_question.metric.questionLIKEOverall Support Experience`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result,t=0;e.forEach(e=>{t+=parseInt(e.metricres_string_value.split("=")[0].trim())}),$j("#csat").text(e.length>0?(t/e.length).toFixed(2):0),$j("#csat_count").text(`#${e.length}`)}},s.send()}(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("sn_customerservice_case","opened_at,resolved_at",`assigned_to=${e}^closed_atBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result,t=[];e.forEach(e=>{t.push((new Date(e.resolved_at)-new Date(e.opened_at))/1e3)}),t.sort(function(e,t){return e-t});var n=Math.floor(t.length/2),a=t.length%2!=0?t[n]:(t[n-1]+t[n])/2;$j("#ttr").text(e.length>0?(a/86400).toFixed(2):0)}},s.send()}(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("kb_knowledge","number",`author=${e}^u_kb_audience=27a515ba7bb63400ff53c5ee4a4d4d2a^ORu_kb_audience=bef6d1727bf63400ff53c5ee4a4d4d43\n                ^publishedBETWEENjavascript:gs.dateGenerate('${t}','start')@javascript:gs.dateGenerate('${a}','end')\n                ^kb_knowledge_base=124c2ca22bb9f1002f42729fe8da152e^ORkb_knowledge_base=a5f38d0b2be931002f42729fe8da1594^workflow_state=published^version.versionSTARTSWITH1.0`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#kb_internal").text(`  ${e}`)}},s.send()}(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("kb_knowledge","number",`author=${e}^u_kb_audience=cb5fc5c06ff3d10016140e9c5d3ee4ec^ORu_kb_audience=4b0819b67bb63400ff53c5ee4a4d4d1f\n                ^publishedBETWEENjavascript:gs.dateGenerate('${t}','start')@javascript:gs.dateGenerate('${a}','end')\n                ^kb_knowledge_base=124c2ca22bb9f1002f42729fe8da152e^ORkb_knowledge_base=a5f38d0b2be931002f42729fe8da1594^workflow_state=published^version.versionSTARTSWITH1.0`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#kb_external").text(e)}},s.send()}(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("sn_customerservice_task","number",`closed_atBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')\n                ^assignment_group=ef170758584120006863f2dea01f7f1c^assigned_to=${e}^short_descriptionNOT LIKEHOP`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#tasks_handled").text(e)}},s.send()}(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("u_case_escalation","number",`cs_assigned_to=${e}^escl_sys_created_onBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#escalations").text(e)}},s.send()}(r),function(e){var t=$j("#start").val(),a=$j("#end").val(),s=n("u_case_history","cs_number",`jour_sys_created_onBETWEENjavascript:gs.dateGenerate('${t}','00:00:00')@javascript:gs.dateGenerate('${a}','23:59:59')\n                ^jour_valueSTARTSWITHSolution rejected^cs_assigned_to=${e}`);s.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result.length;$j("#sol_rejected").text(e)}},s.send()}(r),$j("#download_file").show()}else alert("Select Start Date, End Date, Mananger and Engineer")},!1),document.getElementById("show_trends").addEventListener("click",t,!1),document.getElementById("download_file").addEventListener("click",function(){var e,t=$j("#selected_engineer").val();e=t?t.trim()+".png":"file-name.png";html2canvas(document.getElementById("parent-container-report")).then(function(t){var n,a,s;n=t.toDataURL(),a=e,"string"==typeof(s=document.createElement("a")).download?(s.href=n,s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s)):window.open(n)})},!1),function(){$j("#selected_manager").val("..Loading"),$j("#selected_manager").prop("disabled",!0),$j("#selected_engineer").prop("disabled",!0);var e=n("sys_user","sys_id,name","active=true^department=3a5c578adb99bf44fec4fb2439961984^ORdepartment=66e0413cdb836cd04fee66f748961927^titleLIKEmanager^ORtitleLIKEDirector^ORtitleLIKEMgmt");e.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result;e.forEach(e=>{$j("#select_manager").append(` <option data-value="${e.sys_id}" value="${e.name}"></option>`)}),$j("#selected_manager").val(""),$j("#selected_manager").prop("disabled",!1)}},e.send()}(),$j("#selected_manager").click(function(){$j("#selected_manager").val("")}),$j("#selected_engineer").click(function(){$j("#selected_engineer").val("")}),$j("#selected_manager").change(function(){var e=$j("#selected_manager").val(),t=$j('#select_manager [value="'+e+'"]').data("value").trim();$j("#selected_engineer").val(""),function(e){if($j("#select_engineer").html(""),$j("#selected_engineer").val("..Loading"),$j("#selected_engineer").prop("disabled",!0),!e)return;var t=n("sys_user","sys_id,name",`active=true^department=3a5c578adb99bf44fec4fb2439961984^ORdepartment=66e0413cdb836cd04fee66f748961927^manager=${e}`);t.onreadystatechange=function(){if(this.readyState==this.DONE){var e=JSON.parse(this.response).result;e.forEach(e=>{$j("#select_engineer").append(` <option data-value="${e.sys_id}" value="${e.name}"></option>`)}),$j("#selected_engineer").val(""),$j("#selected_engineer").prop("disabled",!1)}},t.send()}(t)}),(e=document.createElement("div")).innerHTML='\n                <div class="container" id="case-containter1" style="padding-top: 5%">\n                  <div class="row">\n                    <div class="vsplit col-sm-2" id="col11">\n                      <div class="sn-canvas-header-tools custom_header"><p">Total Assigned</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="total_assigned" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col12">\n                      <div class="sn-canvas-header-tools custom_header"><p>Total Closed</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="total_closed" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col13">\n                      <div class="sn-canvas-header-tools custom_header"><p>48 Hours</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="48_closed" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col14">\n                      <div class="sn-canvas-header-tools custom_header"><p>48 Hours %</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="48_closed_precentage" class="count_val"></p></div>\n                    </div>\n                  </div>\n                </div>\n                <style>\n                .count_val{\n                    height: 100px;\n                    line-height: 100px;\n                    font-size: 50px;\n                 }\n                </style>\n                ',$j("#col1").append(e),(e=document.createElement("div")).innerHTML='\n                <div class="container" id="case-containter2" style="padding-top: 5%">\n                  <div class="row">\n                    <div class="vsplit col-sm-2" id="col21">\n                      <div class="sn-canvas-header-tools custom_header" ><p>CSAT</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="csat" class="count_val"></p><span id="csat_count"></span></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col22">\n                      <div class="sn-canvas-header-tools custom_header"><p>TTR</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="ttr" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col23">\n                      <div class="sn-canvas-header-tools custom_header"><p>KB External</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="kb_external" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col24">\n                      <div class="sn-canvas-header-tools custom_header"><p>KB Internal</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="kb_internal" class="count_val"></p></div>\n                    </div>\n                  </div>\n                </div>\n                <style>\n                .count_val{\n                    height: 100px;\n                    line-height: 100px;\n                    font-size: 50px;\n                 }\n                </style>\n                ',$j("#col1").append(e),(e=document.createElement("div")).innerHTML='\n                <div class="container" id="case-containter3" style="padding-top: 5%">\n                  <div class="row">\n                    <div class="vsplit col-sm-2" id="col21">\n                      <div class="sn-canvas-header-tools custom_header"><p>Attach Rate</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="attach_rate" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col22">\n                      <div class="sn-canvas-header-tools custom_header" ><p>Tasks Handled</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="tasks_handled" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col23">\n                      <div class="sn-canvas-header-tools custom_header" ><p>Escalations</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="escalations" class="count_val"></p></div>\n                    </div>\n                    <div class="vsplit col-sm-2" id="col24">\n                      <div class="sn-canvas-header-tools custom_header" ><p>Solution Rejected</p></div>\n                      <div class="sn-canvas-header-tools" style="height: 100px;justify-content: center !IMPORTANT;"><p id="sol_rejected" class="count_val"></p></div>\n                    </div>\n                  </div>\n                </div>\n                <style>\n                .count_val{\n                    height: 100px;\n                    line-height: 100px;\n                    font-size: 50px;\n                 }\n                .custom_header{\n                    height: 1px;\n                    background-color: #80B6A1;\n                    justify-content: center !IMPORTANT;\n                    font-size: 16px;\n                 }\n                </style>\n                ',$j("#col1").append(e)}()},!1)})}();